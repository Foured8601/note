<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>Formatted Medical Report Form with API Request</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            display: flex;
            flex-wrap: nowrap; /* Keep form and sidebar side by side */
            max-width: 1200px;
            margin: 20px auto;
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .main-content {
            flex: 2;
            padding: 20px;
            border-right: 1px solid #ddd;
        }
        .sidebar {
            flex: 1;
            padding: 20px;
            background-color: #f4f4f4;
            overflow-y: auto;
            max-height: 100vh; /* Ensure the sidebar doesn't overflow the viewport */
        }
        textarea, #apiResponse {
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #5c67f2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #5058e5;
        }
        label {
            margin-bottom: 5px;
            display: block;
            color: #666;
        }
        #apiResponse {
            white-space: pre-wrap;
            background: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        .watermark {
            position: fixed;
            bottom: 10px;
            right: 10px;
            opacity: 0.5;
            font-size: 12px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <form id="textForm">
                <h1>Admission Note with AI Integration</h1>
                <div>
                    <label for="a">This is a</label>
                    <textarea id="a" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="b">with a history of</label>
                    <textarea id="b" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="c">According to the patient's statement, he/she suffered from</label>
                    <textarea id="c" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="d">Associated symptoms included</label>
                    <textarea id="d" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="e">Denied symptoms included</label>
                    <textarea id="e" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="k">After that,</label>
                    <textarea id="k" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="f">Physical exam showed</label>
                    <textarea id="f" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="g">Lab data showed</label>
                    <textarea id="g" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="h">Image findings showed</label>
                    <textarea id="h" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="i">Under the impression of</label>
                    <textarea id="i" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <label for="j">, the patient was admitted to our ward for further management</label>
                    <textarea id="j" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <button type="button" onclick="mergeAndSendRequest()">合併內容並生成</button>
                </div>

                <div>
                    <label for="newText">Complete Medical Record</label>
                    <textarea id="newText" rows="4" cols="50"></textarea>
                </div>
                <div>
                    <button type="button" onclick="useNewText()">開始進行生成</button>
                </div>

                <div>
                    <p id="mergedText"></p>
                </div>
                <div id="apiResponse"></div> <!-- Display API response here -->
                <div>
                    <p>若生成失敗，建議先使用 CHATGPT3.5</p>
                    <a href="https://chat.openai.com/chat" target="_blank">https://chat.openai.com/chat</a>
                </div>
                <div class="watermark">Made by Shih-Hung Wang 2024.05.17</div>
            </form>
        </div>

        <div class="sidebar">
            <h2>NIHSS Content</h2>
            <textarea id="txtContent" readonly rows="20"></textarea>
        </div>
    </div>

    <script>
        // Fetch and display the content of the NIHSS.txt file
        fetch('NIHSS.txt')
            .then(response => response.text())
            .then(data => {
                document.getElementById('txtContent').textContent = data;
            })
            .catch(error => {
                console.error('Error fetching the NIHSS.txt:', error);
            });

        function mergeAndSendRequest() {
            // Collect input values
            const a = document.getElementById('a').value;
            const b = document.getElementById('b').value;
            const c = document.getElementById('c').value;
            const d = document.getElementById('d').value;
            const e = document.getElementById('e').value;
            const k = document.getElementById('k').value;
            const f = document.getElementById('f').value;
            const g = document.getElementById('g').value;
            const h = document.getElementById('h').value;
            const i = document.getElementById('i').value;
            const j = document.getElementById('j').value;
            const order = "Please help me correct grammatical and spelling errors. Do not modified any date. Do not use any bold text or bullet points. Here is the text:. Try to include units for all relevant data. Do not use any bold text or bullet points. Present the information in a continuous, narrative paragraph format. Please do not significantly modify the narrative style of the content.  Here is the text:";

            const mergedText = `This is a ${a} with a history of ${b}. According to the patient's statement, he/she suffered from ${c}. Associated symptoms included ${d}. Denied symptoms included ${e}. After that, ${k}. Physical exam showed ${f}. Lab data showed ${g}. Image findings showed ${h}. Under the impression of ${i}, the patient was admitted to our ward for further management ${j}.`;

            // Display merged text
            document.getElementById('mergedText').textContent = mergedText;

            // Copy to clipboard
            const textArea = document.createElement('textarea');
            textArea.value = mergedText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            // Send API Request
            const API_KEY = 'AIzaSyA_35CjLSqweL1N-eLoGMeZ9947G5wG34E';
            const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

            fetch(`${API_URL}?key=${API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: order + mergedText
                        }]
                    }]
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.candidates && data.candidates.length > 0 && data.candidates[0].content) {
                    const textContent = data.candidates[0].content.parts.map(part => part.text).join('\n');
                    document.getElementById('apiResponse').textContent = text
